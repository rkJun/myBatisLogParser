<!DOCTYPE HTML>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<title>MyBatis Log parser</title>
		<script src="js/jquery-2.0.2.js"></script>
		<sciprt src="js/bootstrap.js"></script>
		<script src="js/tipJS-MVC-dev.js"></script>
		<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">

		<style type="text/css">
			body { font-family: monaco, 나눔고딕, "Apple Gothic", sans-serif; }
			textarea { font-family: monaco, 나눔고딕, "Apple Gothic", sans-serif; }
		</style>
	</head>
	<body>
		<div style="margin-left:10px;">
			<h1>myBatis log parser</h1>
			<div id="div_origin" style="float:left">
				<textarea id="txt_origin" rows="20" cols="100"></textarea>
			</div>
			<div id="div_btn" class=".btn" style="float:left;margin-left:20px;">
				<button id="btn_parse" class="btn btn-small">Parse</button>
			</div>
			<div id="div_parse" style="float:left;margin-left:20px;">
				<textarea id="txt_parsing" rows="20" cols="100"></textarea>
			</div>
		</div>
		<script>
			$(document).ready(function() {
				/**
				 * myBatis 로그 합치기
				 * Preparing: Select dummy from dual where col = ? and col2 = ?
				 * Parameters: val1(String), val2(String)
				 *
				 * Result) select ... where col = val1 and col2 = val2
				 *
				 * @return {[type]} [description]
				 */
				var doParse = function () {
					var $txt_origin = $("#txt_origin");
					var $txt_parsing = $("#txt_parsing");

					var originArr = [], parsingArr = [], paramArr = [];
					var paramCnt = 0;
					var result = "";
					var preparing = "";
					var param = {};

					originArr = $txt_origin.val().split("\n");
					parsingArr[0] = originArr[0].substring ( originArr[0].indexOf ("Preparing: ")+11 );
					parsingArr[1] = originArr[1].substring ( originArr[1].indexOf ("Parameters: ")+12 );

					preparing  = parsingArr[0];
					paramArr = parsingArr[1].split(",");

					for (var i = 0; i < paramArr.length; i++) {
						var tempParams = paramArr[i];
						param.val = $.trim ( tempParams.substring(0, tempParams.lastIndexOf("(")) );
						param.typ = tempParams.substring(tempParams.lastIndexOf("(")+1, paramArr[i].lastIndexOf(")"));

						if ( preparing.indexOf("?") >= 0 ) {

							if (param.typ === "String") {
								param.val = "'"+param.val+"'";
							}
							preparing = preparing.replace("?", param.val);
						}

					}
					result = preparing;
					$txt_parsing.html(result);
				};

				$("body").on("click", "button", function (e) {
					doParse();
				});

			});
		</script>
	</body>
</html>

<!--
DEBUG: java.sql.Connection - ==>  Preparing: SELECT TEST1, TEST2 FROM DUAL WHERE COL1 = ? AND COL2 = ? AND NO = ?
DEBUG: java.sql.PreparedStatement - ==> Parameters: test1(String), test2(String), 13(Long)
-->
